var map,markers=[],encontradas,geocoder,markerPesquisado,lat_each=-23.485565,lng_each=-46.502963,latlng,name,address,valores,caminhos,pesquisado=!1,centro=new google.maps.LatLng(lat_each,lng_each),valor_default=1E5,pesquisadoAoRedor=!1,deve_rodar=!1,latlng_pesquisado=new google.maps.LatLng(lat_each,lng_each),pesquisa_nome=!1,exibir_nome,latlng_zoom=[],i_z,latlng_sw=new google.maps.LatLng(-23.917853,-47.067604),latlng_ne=new google.maps.LatLng(-23.325863,-45.912094),bounds=new google.maps.LatLngBounds(latlng_sw,
latlng_ne);function carregar(){initialize();pegaRep(lat_each,lng_each,valor_default)}function initialize(){var a={center:centro,zoom:14,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("google_map"),a);geocoder=new google.maps.Geocoder}google.maps.event.addDomListener(window,"load",initialize);
function pegaRep(a,c,b){var d,a="http://eacherepublica.com.br/republicas.php?list=1&lat="+a+"&lng="+c+"&r="+b+"&n=50";d=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("GET",a,!0);d.send();d.onreadystatechange=function(){4==d.readyState&&(200==d.status&&(valores=eval("("+d.responseText+")"),marcaRep(valores)),404==d.status&&document.write("Not Found"))}}
function marcaRep(a){var c,b,d;encontradas=0;var g=document.getElementById("pesquisar_nome").value,f=document.getElementById("aluguel").value,h=document.getElementById("tipo").value;document.getElementById("distancia_prox");for(var e=0;e<a.length;e++){c=a[e].name;b=a[e].address;d=new google.maps.LatLng(a[e].latitude,a[e].longitude);if(""!=g){if(!1==RegExp(g,"i").test(c))continue}else if(f!=valor_default){if(parseInt(a[e].price)>document.getElementById("aluguel").value)continue}else if(h!=valor_default){if(a[e].gener!=
document.getElementById("tipo").value)continue}else if(document.getElementById("distancia_prox").value!=valor_default)if(deve_rodar){var i=google.maps.geometry.spherical.computeDistanceBetween(latlng_pesquisado,d),j=1E3*document.getElementById("distancia_prox").value;if(i>j)continue}else if(parseInt(a[e].distance)>document.getElementById("distancia_prox").value)continue;try{if(null!=markers[e].getMap())continue}catch(k){}markers[e]=new google.maps.Marker({position:d,map:map,title:c,icon:"img/mapa-marcador-50-sombra.png"});
markers[e].setMap(map);encontradas+=1;d=parseInt(google.maps.geometry.spherical.computeDistanceBetween(d,centro))/1E3;d=d.toFixed(2);b='<div id="content"><h3>'+c+"</h3><p>"+b+"</p><p>"+a[e].gener+" </p><p>Custa R$ "+a[e].price+"</p><p>Dist\u00e2ncia \u00e0 EACH (em linha reta): "+d+"km. </p>";""!=document.getElementById("endereco_prox").value&&(d=Number(a[e].distance).toFixed(2),b=b+"<p>Dist\u00e2ncia ao endere\u00e7o pesquisado (em linha reta): "+d+"km. </p>");b=b+"<p><b>Contato:</b></p><p>Tel: "+
a[e].phone+"</p><p>E-mail: "+a[e].email+"</p></div>";exibir_nome=c;latlng_zoom[e]=markers[e].getPosition();setInfoWindow(markers[e],b)}}function setInfoWindow(a,c){var b=new google.maps.InfoWindow({content:c});google.maps.event.addListener(a,"click",function(){b.setContent(c);b.open(map,a)})}
function pesquisar(){apagaMarkers();var a=document.getElementById("endereco_prox").value,c=document.getElementById("distancia_prox").value,b=document.getElementById("distancia_each").value;""==a&&b==valor_default?marcaRep(valores):""==a&&b!=valor_default?pegaRep(lat_each,lng_each,b/1E3):""!=a&&b==valor_default?pesquisarAoRedorDe(a,c,b):""!=a&&b!=valor_default&&(deve_rodar=!0,b/=1E3,pegaRep(lat_each,lng_each,b),pesquisarAoRedorDe(a,c,document.getElementById("distancia_each").value),deve_rodar=!1)}
function pesquisarAoRedorDe(a,c,b){geocoder.geocode({address:a,region:"br"},function(d,g){if(g==google.maps.GeocoderStatus.OK)if(latlng_pesquisado=new google.maps.LatLng(d[0].geometry.location.lat(),d[0].geometry.location.lng()),!1==bounds.contains(latlng_pesquisado))alert("Caro usu\u00e1rio, as buscas por enndere\u00e7o se limitam aos contidos na Regi\u00e3o Metropolitana de S\u00e3o Paulo. A pesquisa continuar\u00e1, utilizando os demais par\u00e2metros."),marcaRep(valores);else if(b!=valor_default){var f=
google.maps.geometry.spherical.computeDistanceBetween(latlng_pesquisado,centro),h=parseInt(1E3*c)+parseInt(b);document.getElementById("outros_valores").innerHTML="Dist real="+f+" Dist pesq="+h+" dist_prox="+1E3*c+" dist_each="+b;h<f?(f-=h,1E3>f?(f=parseInt(f)+1,alert("Caro usu\u00e1rio, para que seja poss\u00edvel localizar alguma rep\u00fablica, a dist\u00e2ncia \u00e0 EACH (ou a dist\u00e2ncia ao endere\u00e7o pesquisado) deve ser aumentado em no m\u00ednimo "+f+"m.")):(f=parseInt(f/1E3)+1,alert("Caro usu\u00e1rio, para que seja poss\u00edvel localizar alguma rep\u00fablica, a dist\u00e2ncia \u00e0 EACH (ou a dist\u00e2ncia ao endere\u00e7o pesquisado) deve ser aumentado em no m\u00ednimo "+
f+"km.")),apagaMarkers()):(marcaRep(valores),map.panTo(latlng_pesquisado),map.setZoom(14),markerPesquisado=new google.maps.Marker({map:map,position:latlng_pesquisado,animation:google.maps.Animation.DROP,icon:"img/blue-dot.png",title:a}))}else pegaRep(latlng_pesquisado.lat(),latlng_pesquisado.lng(),c),map.panTo(latlng_pesquisado),map.setZoom(14),markerPesquisado=new google.maps.Marker({map:map,position:latlng_pesquisado,animation:google.maps.Animation.DROP,icon:"img/blue-dot.png",title:a});else alert("Favor redigitar o endere\u00e7o.")})}
function adicionar(a,c){var b=document.createElement("p"),d=document.createTextNode(exibir_nome),g=document.createElement("p"),f=document.createTextNode(a);b.appendChild(d);g.appendChild(f);b.setAttribute("class","nome_da_rep");g.setAttribute("class","end_da_rep");b.setAttribute("id","nome"+c);g.setAttribute("id","end"+c);g.setAttribute("onclick","centralizar("+c+")");g.style.cursor="pointer";document.getElementById("teste").appendChild(b);document.getElementById("teste").appendChild(g)}
function apagaMarkers(){for(var a=0;a<markers.length;a++)markers[a].setMap(null);try{markerPesquisado.setMap(null)}catch(c){}}function apagaResultados(){var a=document.getElementById("teste"),c=document.createElement("div");document.body.removeChild(a);c.setAttribute("id","teste");document.body.appendChild(c)}function centralizar(a){document.getElementById("status").innerHTML=a;map.panTo(latlng_zoom[a])}
function limparCampos(){document.getElementById("endereco_prox").value="";document.getElementById("distancia_prox").value=valor_default;document.getElementById("aluguel").value=valor_default;document.getElementById("tipo").value=valor_default;document.getElementById("distancia_each").value=valor_default;document.getElementById("pesquisar_nome").value=""}
function habilitarOuDesabilitarDist(){""!=document.getElementById("endereco_prox").value?(document.getElementById("distancia_prox").disabled=!1,document.getElementById("distancia_prox").title="Dist\u00e2ncia em linha reta ao endere\u00e7o pesquisado."):(document.getElementById("distancia_prox").disabled=!0,document.getElementById("distancia_prox").value=valor_default,document.getElementById("distancia_prox").title="Se deseja usar este recurso, insira um endere\u00e7o v\u00e1lido em sua pesquisa.")}
function resetarMapa(){apagaMarkers();pegaRep(lat_each,lng_each,valor_default);limparCampos();map.panTo(centro);map.setZoom(14)};
